# cloud-config
#
# Provisionamento do Mosquitto Broker no Ubuntu 22.04 via cloud-init
# Autor: Helton Medeiros
# Local: Campina Grande - PB, Brasil
# Data: 19 de junho de 2025
# Requisitos: Ubuntu Server 22.04 LTS ou superior (Multipass/QEMU)
#

hostname: mqtt-gateway
manage_etc_hosts: true
package_update: true
package_upgrade: true

packages:
  - mosquitto
  - mosquitto-clients
  - wget

runcmd:
  # Habilita o serviço Mosquitto
  - systemctl enable mosquitto

  # Cria diretório para configurações adicionais
  #- mkdir -p /etc/mosquitto/conf.d

  # Backup do arquivo original (por segurança)
  #- mv /etc/mosquitto/mosquitto.conf /etc/mosquitto/mosquitto.conf.backup

  # Baixa o novo arquivo de configuração
  #- wget -O /etc/mosquitto/mosquitto.conf https://raw.githubusercontent.com/heltonpierre/airquality-iot-platform/refs/heads/main/mosquitto/mosquitto.conf

  # Reinicia o serviço para aplicar a nova configuração
  - systemctl restart mosquitto
