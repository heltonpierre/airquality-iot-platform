zabbix_export:
  version: '7.4'
  host_groups:
    - uuid: 0d182bb1a88f433190f5c7c1ad42e997
      name: airquality-iot-platform
    - uuid: 8e9c210064a2431e8420e18023b35c53
      name: iot-devices
    - uuid: 0856b55e78e94b8ab3df1c12f23120fb
      name: node-red
  hosts:
    - host: mqtt-gateway
      name: Device01
      description: 'Obs.: O IP do host monitorado não precisa ser configurado no Zabbix Server se estiver somente usando modo ativo. Aqui foi configurado apenas como referência.'
      groups:
        - name: airquality-iot-platform
        - name: iot-devices
        - name: node-red
      interfaces:
        - ip: '{$IPMQTTGATEWAY}'
          interface_ref: if1
      items:
        - name: 'co - ppm'
          type: DEPENDENT
          key: co
          history: 365d
          value_type: FLOAT
          units: ppm
          preprocessing:
            - type: CHECK_NOT_SUPPORTED
              parameters:
                - '-1'
            - type: JSONPATH
              parameters:
                - $.co
            - type: STR_REPLACE
              parameters:
                - ','
                - .
          master_item:
            key: 'mqtt.get["{$IPMQTTGATEWAY}:1883","airq/devices/device01",{$USERMQTTGATEWAY},{$PWDMQTTGATEWAY}]'
        - name: payload-json
          type: ZABBIX_ACTIVE
          key: 'mqtt.get["{$IPMQTTGATEWAY}:1883","airq/devices/device01",{$USERMQTTGATEWAY},{$PWDMQTTGATEWAY}]'
          history: 365d
          value_type: TEXT
          description: 'Tópico MQTT com payload JSON'
        - name: 'no2 - µg/m³'
          type: DEPENDENT
          key: no2
          history: 365d
          units: µg/m³
          preprocessing:
            - type: CHECK_NOT_SUPPORTED
              parameters:
                - '-1'
            - type: JSONPATH
              parameters:
                - $.no2
          master_item:
            key: 'mqtt.get["{$IPMQTTGATEWAY}:1883","airq/devices/device01",{$USERMQTTGATEWAY},{$PWDMQTTGATEWAY}]'
        - name: 'o3 - µg/m³'
          type: DEPENDENT
          key: o3
          history: 365d
          units: µg/m³
          preprocessing:
            - type: CHECK_NOT_SUPPORTED
              parameters:
                - '-1'
            - type: JSONPATH
              parameters:
                - $.o3
          master_item:
            key: 'mqtt.get["{$IPMQTTGATEWAY}:1883","airq/devices/device01",{$USERMQTTGATEWAY},{$PWDMQTTGATEWAY}]'
        - name: 'pm10 - µg/m³'
          type: DEPENDENT
          key: pm10
          history: 365d
          units: µg/m³
          preprocessing:
            - type: CHECK_NOT_SUPPORTED
              parameters:
                - '-1'
            - type: JSONPATH
              parameters:
                - $.pm10
          master_item:
            key: 'mqtt.get["{$IPMQTTGATEWAY}:1883","airq/devices/device01",{$USERMQTTGATEWAY},{$PWDMQTTGATEWAY}]'
        - name: 'pm25 - µg/m³'
          type: DEPENDENT
          key: pm25
          history: 365d
          units: µg/m³
          preprocessing:
            - type: CHECK_NOT_SUPPORTED
              parameters:
                - '-1'
            - type: JSONPATH
              parameters:
                - $.pm25
          master_item:
            key: 'mqtt.get["{$IPMQTTGATEWAY}:1883","airq/devices/device01",{$USERMQTTGATEWAY},{$PWDMQTTGATEWAY}]'
        - name: pressão
          type: DEPENDENT
          key: pressao
          history: 365d
          value_type: FLOAT
          units: hPa
          preprocessing:
            - type: CHECK_NOT_SUPPORTED
              parameters:
                - '-1'
            - type: JSONPATH
              parameters:
                - $.pressao
            - type: STR_REPLACE
              parameters:
                - ','
                - .
          master_item:
            key: 'mqtt.get["{$IPMQTTGATEWAY}:1883","airq/devices/device01",{$USERMQTTGATEWAY},{$PWDMQTTGATEWAY}]'
        - name: 'so2 - µg/m³'
          type: DEPENDENT
          key: so2
          history: 365d
          units: µg/m³
          preprocessing:
            - type: CHECK_NOT_SUPPORTED
              parameters:
                - '-1'
            - type: JSONPATH
              parameters:
                - $.so2
          master_item:
            key: 'mqtt.get["{$IPMQTTGATEWAY}:1883","airq/devices/device01",{$USERMQTTGATEWAY},{$PWDMQTTGATEWAY}]'
        - name: temperatura
          type: DEPENDENT
          key: temperatura
          history: 365d
          value_type: FLOAT
          units: ºC
          preprocessing:
            - type: CHECK_NOT_SUPPORTED
              parameters:
                - '-1'
            - type: JSONPATH
              parameters:
                - $.temperatura
            - type: STR_REPLACE
              parameters:
                - ','
                - .
          master_item:
            key: 'mqtt.get["{$IPMQTTGATEWAY}:1883","airq/devices/device01",{$USERMQTTGATEWAY},{$PWDMQTTGATEWAY}]'
        - name: umidade
          type: DEPENDENT
          key: umidade
          history: 365d
          units: '%'
          preprocessing:
            - type: CHECK_NOT_SUPPORTED
              parameters:
                - '-1'
            - type: JSONPATH
              parameters:
                - $.umidade
          master_item:
            key: 'mqtt.get["{$IPMQTTGATEWAY}:1883","airq/devices/device01",{$USERMQTTGATEWAY},{$PWDMQTTGATEWAY}]'
      macros:
        - macro: '{$IPMQTTGATEWAY}'
          value: 10.33.33.10
        - macro: '{$PWDMQTTGATEWAY}'
          type: SECRET_TEXT
        - macro: '{$USERMQTTGATEWAY}'
          type: SECRET_TEXT
