####################################################################
# Configuração do Mosquitto Broker MQTT
# Local: /var/snap/mosquitto/common/mosquitto.conf
# Autor: Helton Medeiros
# Data: 2025-08-03
# Descrição: Configuração otimizada para simulação de IoT com MQTT
####################################################################

# =================================================================
# Desativa acesso anônimo (obrigatório)
# =================================================================
allow_anonymous false

# =================================================================
# Caminho para arquivo de autenticação (usuários/senhas)
# =================================================================
password_file /var/snap/mosquitto/common/mosquitto_passwd

# =================================================================
# Usa configurações específicas por listener
# =================================================================
per_listener_settings true

# =================================================================
# Listener MQTT padrão (sem TLS)
# =================================================================
listener 1883 0.0.0.0
protocol mqtt

# =================================================================
# Persistência para reter mensagens e sessões
# =================================================================
persistence true
persistence_location /var/snap/mosquitto/common/data/
persistence_file mosquitto.db
autosave_interval 1800              # Salva automaticamente a cada 30min
autosave_on_changes true            # Salva se houver mudanças

# =================================================================
# Logs para depuração e auditoria
# =================================================================
log_dest file /var/snap/mosquitto/common/mosquitto.log
log_type error
log_type warning
log_type notice
connection_messages true
log_timestamp true

# =================================================================
# Parâmetros de desempenho e filas
# =================================================================
max_inflight_messages 50            # Mensagens simultâneas por cliente
max_queued_messages 1000            # Mensagens retidas por cliente off-line
message_size_limit 262144           # Tamanho máx. da mensagem: 256 KB

# =================================================================
# Intervalo para mensagens $SYS/ (monitoramento interno)
# =================================================================
sys_interval 60

# =================================================================
# Configuração opcional de TLS para produção
# =================================================================
# listener 8883 0.0.0.0
# protocol mqtt
# cafile /var/snap/mosquitto/common/certs/ca.crt
# certfile /var/snap/mosquitto/common/certs/server.crt
# keyfile /var/snap/mosquitto/common/certs/server.key
# require_certificate false
# tls_version tlsv1.2